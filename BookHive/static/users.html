<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BookHive - Users Admin</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    .item { border-bottom: 1px solid #eee; padding: 6px 0; }
    .msg { color: green; }
    .err { color: red; }
  </style>
</head>
<body>
  <h1>Users Management</h1>
  <form id="user-add-form">
    <label>Username</label><input type="text" id="user-username" required>
    <label>Email</label><input type="email" id="user-email" required>
    <label>Password</label><input type="password" id="user-password" required>
    <button type="submit">Add User</button>
  </form>
  <div id="user-msg"></div>
  <button onclick="fetchUsers()">Refresh List</button>
  <div id="user-list"></div>
  <script>
    document.getElementById('user-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const username = document.getElementById('user-username').value;
      const email = document.getElementById('user-email').value;
      const password = document.getElementById('user-password').value;
      const resp = await fetch('/register', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({username, email, password})
      });
      const data = await resp.json();
      document.getElementById('user-msg').innerText = data.message || JSON.stringify(data);
      fetchUsers();
    };
    async function fetchUsers() {
      const r = await fetch('/users');
      const d = await r.json();
      let html = '';
      (d.users||[]).forEach(u => {
        html += `<div class="item"><span>${u.id}: ${u.username} (${u.email})</span> <button onclick="deleteUser(${u.id})">Delete</button></div>`;
      });
      document.getElementById('user-list').innerHTML = html;
    }
    async function deleteUser(id) {
      await fetch('/users/'+id, {method:'DELETE'});
      fetchUsers();
    }
    window.onload = fetchUsers;
  </script>
</body>
</html>
