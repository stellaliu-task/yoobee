<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BookHive Admin Panel</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    .tabs { margin-bottom: 12px; }
    .tab { display: inline-block; margin-right: 10px; padding: 8px 20px; background: #eee; border-radius: 7px 7px 0 0; cursor: pointer; }
    .tab.active { background: #fff; border-bottom: 2px solid #fff; }
    .panel { display: none; border: 1px solid #bbb; border-top: none; padding: 20px; border-radius: 0 0 7px 7px; }
    .panel.active { display: block; }
    label { display: block; margin: 5px 0 2px; }
    input, select, textarea { width: 100%; margin-bottom: 8px; padding: 7px; box-sizing: border-box; }
    button { margin: 3px 0 10px 0; padding: 7px 15px; }
    .item-list { margin-top: 10px; }
    .item { border-bottom: 1px solid #eee; padding: 5px 0 7px 0; }
    .item span { margin-right: 15px; }
    .section-title { font-size: 18px; margin: 12px 0 7px; }
    .msg { color: green; }
    .err { color: red; }
  </style>
</head>
<body>
  <h1>BookHive Admin Panel</h1>
  <div class="tabs">
    <span class="tab active" onclick="showTab('users')">Users</span>
    <span class="tab" onclick="showTab('admins')">Admins</span>
    <span class="tab" onclick="showTab('books')">Books</span>
    <span class="tab" onclick="showTab('tags')">Tags</span>
    <span class="tab" onclick="showTab('themes')">Themes</span>
    <span class="tab" onclick="showTab('assignments')">Assignments</span>
    <span class="tab" onclick="showTab('reviews')">Reviews</span>
    <span class="tab" onclick="showTab('likes')">Likes</span>
    <span class="tab" onclick="showTab('activities')">Activities</span>
  </div>

  <!-- Users Panel -->
  <div class="panel active" id="panel-users">
    <div class="section-title">Users</div>
    <form id="user-add-form">
      <label>Username</label><input type="text" id="user-username" required>
      <label>Email</label><input type="email" id="user-email" required>
      <label>Password</label><input type="password" id="user-password" required>
      <button type="submit">Add User</button>
    </form>
    <div id="user-msg"></div>
    <button onclick="fetchUsers()">Refresh List</button>
    <div class="item-list" id="user-list"></div>
  </div>

  <!-- Admins Panel -->
  <div class="panel" id="panel-admins">
    <div class="section-title">Admins</div>
    <form id="admin-add-form">
      <label>Username</label><input type="text" id="admin-username" required>
      <label>Email</label><input type="email" id="admin-email" required>
      <label>Password</label><input type="password" id="admin-password" required>
      <button type="submit">Add Admin</button>
    </form>
    <div id="admin-msg"></div>
    <button onclick="fetchAdmins()">Refresh List</button>
    <div class="item-list" id="admin-list"></div>
  </div>

  <!-- Books Panel -->
  <div class="panel" id="panel-books">
    <div class="section-title">Books</div>
    <form id="book-add-form">
      <label>Title</label><input type="text" id="book-title" required>
      <label>Author</label><input type="text" id="book-author" required>
      <label>User ID</label><input type="number" id="book-user-id" required>
      <label>Description</label><textarea id="book-desc"></textarea>
      <label>Catalog</label><input type="text" id="book-catalog">
      <label>Status</label>
      <select id="book-status">
        <option value="want_to_read">Want to Read</option>
        <option value="reading">Reading</option>
        <option value="read">Read</option>
      </select>
      <button type="submit">Add Book</button>
    </form>
    <div id="book-msg"></div>
    <button onclick="fetchBooks()">Refresh List</button>
    <div class="item-list" id="book-list"></div>
  </div>

  <!-- Tags Panel -->
  <div class="panel" id="panel-tags">
    <div class="section-title">Tags</div>
    <form id="tag-add-form">
      <label>Name</label><input type="text" id="tag-name" required>
      <button type="submit">Add Tag</button>
    </form>
    <div id="tag-msg"></div>
    <button onclick="fetchTags()">Refresh List</button>
    <div class="item-list" id="tag-list"></div>
  </div>

  <!-- Themes Panel -->
  <div class="panel" id="panel-themes">
    <div class="section-title">Themes</div>
    <form id="theme-add-form">
      <label>Title</label><input type="text" id="theme-title" required>
      <button type="submit">Add Theme</button>
    </form>
    <div id="theme-msg"></div>
    <button onclick="fetchThemes()">Refresh List</button>
    <div class="item-list" id="theme-list"></div>
  </div>

  <!-- Assignments Panel -->
  <div class="panel" id="panel-assignments">
    <div class="section-title">Book-Tags Assignment</div>
    <form id="book-tag-form">
      <label>Book ID</label><input type="number" id="assign-book-id" required>
      <label>Tag ID</label><input type="number" id="assign-tag-id" required>
      <button type="submit">Assign Tag to Book</button>
    </form>
    <div id="booktag-msg"></div>
    <button onclick="fetchBookTags()">Refresh Book-Tag List</button>
    <div class="item-list" id="book-tag-list"></div>

    <div class="section-title" style="margin-top:20px;">Theme-Books Assignment</div>
    <form id="theme-book-form">
      <label>Theme ID</label><input type="number" id="assign-theme-id" required>
      <label>Book ID</label><input type="number" id="assign-theme-book-id" required>
      <button type="submit">Assign Book to Theme</button>
    </form>
    <div id="themebook-msg"></div>
    <button onclick="fetchThemeBooks()">Refresh Theme-Book List</button>
    <div class="item-list" id="theme-book-list"></div>
  </div>

  <!-- Reviews Panel -->
  <div class="panel" id="panel-reviews">
    <div class="section-title">Reviews</div>
    <form id="review-add-form">
      <label>User ID</label><input type="number" id="review-user-id" required>
      <label>Activity ID</label><input type="number" id="review-activity-id" required>
      <label>Content</label><textarea id="review-content" required></textarea>
      <button type="submit">Add Review</button>
    </form>
    <div id="review-msg"></div>
    <button onclick="fetchReviews()">Refresh List</button>
    <div class="item-list" id="review-list"></div>
  </div>

  <!-- Likes Panel -->
  <div class="panel" id="panel-likes">
    <div class="section-title">Likes</div>
    <form id="like-add-form">
      <label>User ID</label><input type="number" id="like-user-id" required>
      <label>Activity ID</label><input type="number" id="like-activity-id" required>
      <button type="submit">Add Like</button>
    </form>
    <div id="like-msg"></div>
    <button onclick="fetchLikes()">Refresh List</button>
    <div class="item-list" id="like-list"></div>
  </div>

  <!-- Activities Panel -->
  <div class="panel" id="panel-activities">
    <div class="section-title">Activities</div>
    <button onclick="fetchActivities()">Refresh List</button>
    <div class="item-list" id="activity-list"></div>
  </div>

  <script>
    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
      document.getElementById('panel-' + tab).classList.add('active');
    }

    // ---- USERS ----
    document.getElementById('user-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const username = user_username.value, email = user_email.value, password = user_password.value;
      const resp = await fetch('/register', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({username, email, password}) });
      const data = await resp.json();
      user_msg.innerHTML = data.message || JSON.stringify(data);
      fetchUsers();
    };
    async function fetchUsers() {
      const r = await fetch('/users'); const d = await r.json();
      user_list.innerHTML = (d.users||[]).map(u => `<div class="item"><span>${u.id}: ${u.username} (${u.email})</span><button onclick="deleteUser(${u.id})">Delete</button></div>`).join('');
    }
    async function deleteUser(id) {
      await fetch('/users/'+id, {method:'DELETE'});
      fetchUsers();
    }

    // ---- ADMINS ----
    document.getElementById('admin-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const name = admin_username.value, email = admin_email.value, password = admin_password.value;
      const resp = await fetch('/admins', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({name, email, password}) });
      const data = await resp.json();
      admin_msg.innerHTML = data.message || JSON.stringify(data);
      fetchAdmins();
    };
    async function fetchAdmins() {
      const r = await fetch('/admins'); const d = await r.json();
      admin_list.innerHTML = (d.admins||[]).map(a => `<div class="item"><span>${a.id}: ${a.name} (${a.email})</span><button onclick="deleteAdmin(${a.id})">Delete</button></div>`).join('');
    }
    async function deleteAdmin(id) {
      await fetch('/admins/'+id, {method:'DELETE'});
      fetchAdmins();
    }

    // ---- BOOKS ----
    document.getElementById('book-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const title = book_title.value, author = book_author.value, user_id = book_user_id.value, description = book_desc.value, catalog = book_catalog.value, status = book_status.value;
      const resp = await fetch('/books', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({title, author, user_id, description, catalog, status}) });
      const data = await resp.json();
      book_msg.innerHTML = data.message || JSON.stringify(data);
      fetchBooks();
    };
    async function fetchBooks() {
      const r = await fetch('/books'); const d = await r.json();
      book_list.innerHTML = (d.books||[]).map(b => `<div class="item"><span>${b.id}: ${b.title} (${b.author}) [status:${b.status}]</span><button onclick="deleteBook(${b.id})">Delete</button></div>`).join('');
    }
    async function deleteBook(id) {
      await fetch('/books/'+id, {method:'DELETE'});
      fetchBooks();
    }

    // ---- TAGS ----
    document.getElementById('tag-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const name = tag_name.value;
      const resp = await fetch('/tags', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({name}) });
      const data = await resp.json();
      tag_msg.innerHTML = data.message || JSON.stringify(data);
      fetchTags();
    };
    async function fetchTags() {
      const r = await fetch('/tags'); const d = await r.json();
      tag_list.innerHTML = (d.tags||[]).map(t => `<div class="item"><span>${t.id}: ${t.name}</span><button onclick="deleteTag(${t.id})">Delete</button></div>`).join('');
    }
    async function deleteTag(id) {
      await fetch('/tags/'+id, {method:'DELETE'});
      fetchTags();
    }

    // ---- THEMES ----
    document.getElementById('theme-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const title = theme_title.value;
      const resp = await fetch('/themes', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({title}) });
      const data = await resp.json();
      theme_msg.innerHTML = data.message || JSON.stringify(data);
      fetchThemes();
    };
    async function fetchThemes() {
      const r = await fetch('/themes'); const d = await r.json();
      theme_list.innerHTML = (d.themes||[]).map(t => `<div class="item"><span>${t.id}: ${t.title} (hidden:${t.is_hidden})</span><button onclick="deleteTheme(${t.id})">Delete</button></div>`).join('');
    }
    async function deleteTheme(id) {
      await fetch('/themes/'+id, {method:'DELETE'});
      fetchThemes();
    }

    // ---- BOOK-TAGS ASSIGNMENT ----
    document.getElementById('book-tag-form').onsubmit = async function(e) {
      e.preventDefault();
      const book_id = document.getElementById('assign_book_id').value, tag_id = document.getElementById('assign_book_id').value;
      const resp = await fetch('/book_tags', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({book_id, tag_id}) });
      const data = await resp.json();
      booktag_msg.innerHTML = data.message || JSON.stringify(data);
      fetchBookTags();
    };
    async function fetchBookTags() {
      const r = await fetch('/book_tags'); const d = await r.json();
      book_tag_list.innerHTML = (d.book_tags||[]).map(bt => `<div class="item"><span>Book ${bt.book_id} - Tag ${bt.tag_id}</span><button onclick="deleteBookTag(${bt.book_id},${bt.tag_id})">Remove</button></div>`).join('');
    }
    async function deleteBookTag(book_id, tag_id) {
      await fetch(`/book_tags?book_id=${book_id}&tag_id=${tag_id}`, {method:'DELETE'});
      fetchBookTags();
    }

    // ---- THEME-BOOKS ASSIGNMENT ----
    document.getElementById('theme-book-form').onsubmit = async function(e) {
      e.preventDefault();
      const theme_id = assign_theme_id.value, book_id = assign_theme_book_id.value;
      const resp = await fetch('/theme_books', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({theme_id, book_id}) });
      const data = await resp.json();
      themebook_msg.innerHTML = data.message || JSON.stringify(data);
      fetchThemeBooks();
    };
    async function fetchThemeBooks() {
      const r = await fetch('/theme_books'); const d = await r.json();
      theme_book_list.innerHTML = (d.theme_books||[]).map(tb => `<div class="item"><span>Theme ${tb.theme_id} - Book ${tb.book_id}</span><button onclick="deleteThemeBook(${tb.theme_id},${tb.book_id})">Remove</button></div>`).join('');
    }
    async function deleteThemeBook(theme_id, book_id) {
      await fetch(`/theme_books?theme_id=${theme_id}&book_id=${book_id}`, {method:'DELETE'});
      fetchThemeBooks();
    }

    // ---- REVIEWS ----
    document.getElementById('review-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const user_id = review_user_id.value, activity_id = review_activity_id.value, content = review_content.value;
      const resp = await fetch('/reviews', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({user_id, activity_id, content}) });
      const data = await resp.json();
      review_msg.innerHTML = data.message || JSON.stringify(data);
      fetchReviews();
    };
    async function fetchReviews() {
      const r = await fetch('/reviews'); const d = await r.json();
      review_list.innerHTML = (d.reviews||[]).map(rv => `<div class="item"><span>${rv.id}: User ${rv.user_id} - Activity ${rv.activity_id}: ${rv.content}</span><button onclick="deleteReview(${rv.id})">Delete</button></div>`).join('');
    }
    async function deleteReview(id) {
      await fetch('/reviews/'+id, {method:'DELETE'});
      fetchReviews();
    }

    // ---- LIKES ----
    document.getElementById('like-add-form').onsubmit = async function(e) {
      e.preventDefault();
      const user_id = like_user_id.value, activity_id = like_activity_id.value;
      const resp = await fetch('/likes', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({user_id, activity_id}) });
      const data = await resp.json();
      like_msg.innerHTML = data.message || JSON.stringify(data);
      fetchLikes();
    };
    async function fetchLikes() {
      const r = await fetch('/likes'); const d = await r.json();
      like_list.innerHTML = (d.likes||[]).map(lk => `<div class="item"><span>${lk.id}: User ${lk.user_id} - Activity ${lk.activity_id}</span><button onclick="deleteLike(${lk.id})">Delete</button></div>`).join('');
    }
    async function deleteLike(id) {
      await fetch('/likes/'+id, {method:'DELETE'});
      fetchLikes();
    }

    // ---- ACTIVITIES ----
    async function fetchActivities() {
      const r = await fetch('/activities'); const d = await r.json();
      activity_list.innerHTML = (d.activities||[]).map(a => `<div class="item"><span>${a.id}: User ${a.user_id}, Book ${a.book_id}, ${a.action}, ${a.message}</span></div>`).join('');
    }

    // ---- Load initial data on page load ----
    window.onload = function() {
      fetchUsers();
      fetchAdmins();
      fetchBooks();
      fetchTags();
      fetchThemes();
      fetchBookTags();
      fetchThemeBooks();
      fetchReviews();
      fetchLikes();
      fetchActivities();
    }
  </script>
</body>
</html>
